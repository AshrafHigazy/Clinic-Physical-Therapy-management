@model IEnumerable<Clinic_Management_System.Models.Package>

@{
    ViewData["Title"] = "قائمة الباقات";
}

<div class="container py-4">

    <!-- 🔹 الكارد الرئيسي -->
    <div class="card card-modern mt-3">

        <!-- 🔹 العنوان + زر عرض المرضى -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="text-primary fw-bold m-0">
                <i class="bi bi-box-seam"></i> قائمة الباقات
            </h3>
            <a asp-controller="Patient" asp-action="GetAll"
               class="btn btn-outline-info rounded-pill px-4">
                👥 عرض كل المرضى
            </a>
        </div>

        <!-- 🔹 الجدول -->
        <div class="table-responsive">
            <table class="table table-hover table-modern text-center align-middle">
                <thead class="table-primary text-dark">
                    <tr>
                        <th>رقم</th>
                        <th>المريض</th>
                        <th>الطبيب المتدرب</th>
                        <th>المؤسسة</th>
                        <th>نوع الباقة</th>
                        <th>عدد الجلسات</th>
                        <th>تم تنفيذ</th>
                        <th>المبلغ المدفوع</th>
                        <th>الحالة</th>
                        <th>تاريخ البداية</th>
                        <th>تاريخ النهاية</th>
                        <th>العمليات</th>
                    </tr>
                </thead>

                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        foreach (var pkg in Model)
                        {
                            var isEnded = pkg.Status == "Ended";

                            <tr class="@(isEnded ? "table-light text-muted" : "")">
                                <td>@pkg.Id</td>
                                <td>@(pkg.Patient?.FullName ?? "—")</td>
                                <td>@(pkg.InternDoctor?.FullName ?? "—")</td>
                                <td>@(pkg.Organization?.Name ?? "—")</td>
                                <td>@pkg.Type.ToString()</td>
                                <td>@pkg.NumOfSessions</td>
                                <td>@(pkg.TreatmentSessions?.Count() ?? 0)</td>
                                <td>@pkg.AmountPaid.ToString("0.00") ج.م</td>

                                <td>
                                    @if (isEnded)
                                    {
                                        <span class="badge bg-danger px-3 py-2">منتهية</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-success px-3 py-2">نشطة</span>
                                    }
                                </td>

                                <td>@pkg.StartDate.ToString("yyyy/MM/dd")</td>
                                <td>@(pkg.EndDate.HasValue? pkg.EndDate.Value.ToString("yyyy/MM/dd") : "—")</td>

                                <td>
                                    <div class="d-flex justify-content-center gap-1 flex-wrap">
                                        <a asp-action="Details" asp-route-id="@pkg.Id"
                                           class="btn btn-sm btn-outline-info rounded-pill">
                                            تفاصيل
                                        </a>

                                        <a asp-action="Edit" asp-route-id="@pkg.Id"
                                           class="btn btn-sm btn-outline-warning rounded-pill text-dark">
                                            تعديل
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="12" class="text-warning fw-semibold text-center py-3">
                                ⚠ لا توجد باقات حالياً
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <style>
        /* 🎨 الكارد الموحد */
        .card-modern {
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 119, 182, 0.45);
            padding: 30px;
            border: 2px solid #0077B6;
            animation: fadeIn 0.4s ease;
        }

        /* 🎨 تنسيق الجدول */
        .table-modern {
            border-radius: 12px;
            overflow: hidden;
            background: #ffffff;
            box-shadow: 0 4px 15px rgba(0, 119, 182, 0.25);
        }

            .table-modern th {
                background-color: #eaf9fb !important;
                color: #0077B6;
                font-weight: 700;
                border-bottom: 2px solid #00B4D8;
            }

            .table-modern td {
                border-color: #dee2e6;
                vertical-align: middle;
            }

            .table-modern tbody tr:hover {
                background-color: #f3fcfd !important;
                transition: 0.2s ease;
            }

        /* 🎨 الأزرار */
        .btn-outline-info:hover {
            background-color: #00B4D8;
            border-color: #00B4D8;
            color: #fff !important;
        }

        .btn-outline-warning:hover {
            background-color: #ffb703;
            border-color: #ffb703;
            color: #fff !important;
        }

        @@keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
}
